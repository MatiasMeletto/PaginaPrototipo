@page "/hamburguesas"

<div>
    <form action="#">
        <div class="container">
            <label>PAN</label>
            <br>
            <label>
                Lechuga
                <input @bind="Model.LechugaCant" type="number" min="0" max="3" />
            </label>
            <br>
            <label>
                Tomate
                <input @bind="Model.TomateCant" type="number" min="0" max="3" />
            </label>
            <br>
            <label>
                Huevo
                <input @bind="Model.HuevoCant" type="number" min="0" max="2" />
            </label>
            <br>
            <label>
                Bacon
                <input @bind="Model.BaconCant" type="number" min="0" max="4" />
            </label>
            <br>
            <label>
                Cheddar
                <input @bind="Model.CheddarCant" type="number" min="0" max="2" />
            </label>
            <br>
            <label>
                Tybo
                <input @bind="Model.TyboCant" type="number" min="0" max="2" />
            </label>
            <br>
            <label>
                Jamon
                <input @bind="Model.JamonCant" type="number" min="0" max="2" />
            </label>
            <br>
            <label>
                Cebolla
                <input @bind="Model.CebollaCant" type="number" min="0" max="3" />
            </label>
            <br>
            <label>
                Mayonesa
                <input @bind="Model.MayonesaCant" type="number" min="0" max="1" />
            </label>
            <br>
            <label>
                Ketchup
                <input @bind="Model.KetchupCant" type="number" min="0" max="1" />
            </label>
            <br>
            <label>
                Mostaza
                <input @bind="Model.MostazaCant" type="number" min="0" max="1" />
            </label>
            <br>
            <label>
                Sabora
                <input @bind="Model.SaboraCant" type="number" min="0" max="1" />
            </label>
            <br>
            <label>
                Carne
                <input @bind="Model.CarneCant" type="number" min="1" max="3" />
            </label>
            <br>
            <label>PAN</label>
            <br>
            <br>
            <br>
            <label>
                Cantidad
                <input @bind="Model.HamburguesaCant" type="number" min="1" max="5" />
            </label>
            <br>
        </div>
    </form>
    <button class="btn btn-primary" @onclick="CargarProductoCarro">Agregar al carrito</button>
    <button class="btn btn-primary" @onclick="VerCarrito">Ver carrito</button>
</div>
<div>
    <h2>Precio = @EscribirPrecio</h2>
</div>

@code {

    private class ProductoViewModel
    {
        public int LechugaCant { get; set; }
        public int TomateCant { get; set; }
        public int HuevoCant { get; set; }
        public int BaconCant { get; set; }
        public int CheddarCant { get; set; }
        public int TyboCant { get; set; }
        public int JamonCant { get; set; }
        public int CebollaCant { get; set; }
        public int MayonesaCant { get; set; }
        public int KetchupCant { get; set; }
        public int MostazaCant { get; set; }
        public int SaboraCant { get; set; }
        public int CarneCant { get; set; }
        public int HamburguesaCant { get; set; }
    }

    private ProductoViewModel Model { get; set; } = new();

    private void CargarProductoCarro()
    {
        using var db = new CompraContext();

        Carrito carrito = db.Carritos.Include(c => c.Productos).ThenInclude(p => p.Adicionales).Where(c => c.UsuarioId == 1).SingleOrDefault();

        if (carrito is not null)
        {
            CarritoProducto carritoProducto = new CarritoProducto()
            {
                ProductoId = 1,
                Cantidad = Model.HamburguesaCant,
                Adicionales = new()
            };

            carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
            {
                //pan
                AdicionalId = 3,
                Cantidad = 2
            });

            if (Model.CarneCant != 0)
            {
                //carne
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 4,
                    Cantidad = Model.CarneCant
                });
            }
            if (Model.LechugaCant != 0)
            {
                //lechuga
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 5,
                    Cantidad = Model.LechugaCant
                });
            }
            if (Model.TomateCant != 0)
            {
                //tomate
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 6,
                    Cantidad = Model.TomateCant
                });
            }
            if (Model.HuevoCant != 0)
            {
                //huevo
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 7,
                    Cantidad = Model.HuevoCant
                });
            }
            if (Model.BaconCant != 0)
            {
                //bacon
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 8,
                    Cantidad = Model.BaconCant
                });
            }
            if (Model.CheddarCant != 0)
            {
                //cheddar
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 9,
                    Cantidad = Model.CheddarCant
                });
            }
            if (Model.TyboCant != 0)
            {
                //tybo
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 10,
                    Cantidad = Model.TyboCant
                });
            }
            if (Model.JamonCant != 0)
            {
                //jamon
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 11,
                    Cantidad = Model.JamonCant
                });
            }
            if (Model.CebollaCant != 0)
            {
                //cebolla
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 12,
                    Cantidad = Model.CebollaCant
                });
            }
            if (Model.MayonesaCant != 0)
            {
                //mayonesa
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 13,
                    Cantidad = Model.MayonesaCant
                });
            }
            if (Model.KetchupCant != 0)
            {
                //ketchup
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 14,
                    Cantidad = Model.KetchupCant
                });
            }
            if (Model.MostazaCant != 0)
            {
                //mostaza
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 15,
                    Cantidad = Model.MostazaCant
                });
            }
            if (Model.SaboraCant != 0)
            {
                carritoProducto.Adicionales.Add(new CarritoProductoAdicional()
                {
                    AdicionalId = 16,
                    Cantidad = Model.SaboraCant
                });
            }

            carrito.Productos.Add(carritoProducto);
            db.SaveChanges();
        }
        else
        {
            //anashe
        } 
    }

    private void VerCarrito()
    {
        using var db = new CompraContext();

        Carrito carrito = db.Carritos
        .Include(c => c.Usuario)
        .Include(c => c.Productos)
        .ThenInclude(p => p.Producto)
        .ThenInclude(p => p.Adicionales)
        .Include(c => c.Productos).ThenInclude(p => p.Adicionales)
        .Where(c => c.UsuarioId == 1).SingleOrDefault();
    }

    private int EscribirPrecio()
    {
        using var db = new CompraContext();

        Carrito carrito = db.Carritos
        .Include(c => c.Usuario)
        .Include(c => c.Productos)
        .ThenInclude(p => p.Producto)
        .ThenInclude(p => p.Adicionales)
        .Include(c => c.Productos).ThenInclude(p => p.Adicionales)
        .Where(c => c.UsuarioId == 1).SingleOrDefault();

        int total = 0;

        foreach (Producto p in carrito)
        {
            
        }

        return total;
    }

}
